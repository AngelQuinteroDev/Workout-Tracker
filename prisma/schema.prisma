generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model comments {
  id         Int       @id @default(autoincrement())
  workout_id Int
  user_id    Int
  content    String
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  workouts   workouts  @relation(fields: [workout_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_comments_user_id")
  @@index([workout_id], map: "idx_comments_workout_id")
}

model group_members {
  id        Int       @id @default(autoincrement())
  user_id   Int
  group_id  Int
  role      String?   @default("member") @db.VarChar(50)
  joined_at DateTime? @default(now()) @db.Timestamp(6)
  groups    groups    @relation(fields: [group_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users     users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, group_id])
  @@index([group_id], map: "idx_group_members_group_id")
  @@index([user_id], map: "idx_group_members_user_id")
}

model group_progress {
  id                    Int       @id @default(autoincrement())
  group_id              Int       @unique
  total_members         Int?      @default(0)
  total_workouts        Int?      @default(0)
  completed_workouts    Int?      @default(0)
  completion_percentage Int?      @default(0)
  last_update           DateTime? @default(now()) @db.Timestamp(6)
  groups                groups    @relation(fields: [group_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([group_id], map: "idx_group_progress_group_id")
}

model groups {
  id             Int             @id @default(autoincrement())
  name           String          @db.VarChar(100)
  description    String?
  created_by     Int
  created_at     DateTime?       @default(now()) @db.Timestamp(6)
  updated_at     DateTime?       @default(now()) @db.Timestamp(6)
  group_members  group_members[]
  group_progress group_progress?
  users          users           @relation(fields: [created_by], references: [id], onDelete: Cascade, onUpdate: NoAction)
  progress       progress[]
  workouts       workouts[]

  @@index([created_by], map: "idx_groups_created_by")
}

model progress {
  id                    Int       @id @default(autoincrement())
  user_id               Int?
  group_id              Int?
  total_tasks           Int?      @default(0)
  completed_tasks       Int?      @default(0)
  total_workouts        Int?      @default(0)
  completed_workouts    Int?      @default(0)
  completion_percentage Int?      @default(0)
  last_update           DateTime? @default(now()) @db.Timestamp(6)
  groups                groups?   @relation(fields: [group_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users                 users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, group_id])
  @@index([group_id], map: "idx_progress_group_id")
  @@index([user_id], map: "idx_progress_user_id")
}

model task_assignments {
  id                                        Int       @id @default(autoincrement())
  task_id                                   Int
  assigned_to                               Int
  assigned_by                               Int
  completed                                 Boolean?  @default(false)
  completed_at                              DateTime? @db.Timestamp(6)
  created_at                                DateTime? @default(now()) @db.Timestamp(6)
  updated_at                                DateTime? @default(now()) @db.Timestamp(6)
  users_task_assignments_assigned_byTousers users     @relation("task_assignments_assigned_byTousers", fields: [assigned_by], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users_task_assignments_assigned_toTousers users     @relation("task_assignments_assigned_toTousers", fields: [assigned_to], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tasks                                     tasks     @relation(fields: [task_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([task_id, assigned_to])
  @@index([assigned_to], map: "idx_task_assignments_assigned_to")
  @@index([task_id], map: "idx_task_assignments_task_id")
}

model tasks {
  id               Int                @id @default(autoincrement())
  workout_id       Int
  title            String             @db.VarChar(100)
  description      String
  order_number     Int?               @default(0)
  completed        Boolean?           @default(false)
  completed_at     DateTime?          @db.Timestamp(6)
  created_at       DateTime?          @default(now()) @db.Timestamp(6)
  updated_at       DateTime?          @default(now()) @db.Timestamp(6)
  task_assignments task_assignments[]
  workouts         workouts           @relation(fields: [workout_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([completed], map: "idx_tasks_completed")
  @@index([workout_id], map: "idx_tasks_workout_id")
}

model users {
  id                                                   Int                @id @default(autoincrement())
  name                                                 String             @db.VarChar(100)
  email                                                String             @unique @db.VarChar(100)
  password_hash                                        String
  role                                                 String?            @default("user") @db.VarChar(50)
  refresh_token                                        String?
  created_at                                           DateTime?          @default(now()) @db.Timestamp(6)
  updated_at                                           DateTime?          @default(now()) @db.Timestamp(6)
  comments                                             comments[]
  group_members                                        group_members[]
  groups                                               groups[]
  progress                                             progress[]
  task_assignments_task_assignments_assigned_byTousers task_assignments[] @relation("task_assignments_assigned_byTousers")
  task_assignments_task_assignments_assigned_toTousers task_assignments[] @relation("task_assignments_assigned_toTousers")
  workouts                                             workouts[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model workouts {
  id               Int        @id @default(autoincrement())
  user_id          Int
  group_id         Int?
  title            String     @db.VarChar(100)
  description      String?
  duration_minutes Int?
  completed        Boolean?   @default(false)
  completed_at     DateTime?  @db.Timestamp(6)
  created_at       DateTime?  @default(now()) @db.Timestamp(6)
  updated_at       DateTime?  @default(now()) @db.Timestamp(6)
  comments         comments[]
  tasks            tasks[]
  groups           groups?    @relation(fields: [group_id], references: [id], onUpdate: NoAction)
  users            users      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([completed], map: "idx_workouts_completed")
  @@index([group_id], map: "idx_workouts_group_id")
  @@index([user_id], map: "idx_workouts_user_id")
}
